{% extends 'base.html' %}
{% load template_tags %}

{% block content %}
<div id="articleContainer">
    {% if not post %}
        <h1>The page you are looking for cannot be found...</h1>
    {% else %}
        <div class="articlebody">

        <div id="toolbar">
        {% if post.author == user %}
            <button id="edit_btn" onclick="location.href='edit'">Edit
                <ion-icon name="create-outline"></ion-icon>
            </button>
            {# if post is not published show the publish button #}
            {% if post.status != 1 %}
                <button id="publish_btn" onclick="location.href='publish'"
                        title="Published posts are visible and accessible by the public">Publish
                    <ion-icon name="cloud-upload-outline"></ion-icon>
                </button>
            {% endif %}
            {# If the post is not unpublished, show the unpublish button #}
            {% if post.status != 0%}
                <button id="unpublish_btn" onclick="location.href='unpublish'"
                        title="Unpublished posts are not visible to the public and only you can access them">
                    Unpublish
                    <ion-icon name="cloud-offline-outline"></ion-icon>
                </button>
            {% endif %}
            {# If the post is not unlisted, show the unlist button #}
            {% if post.status != 2 %}
                <button id="unlist_btn" onclick="location.href='unlist'"
                        title="Unlisted posts are not visible to the public but anyone with the URL can access them">
                    Unlist
                    <ion-icon name="link-outline"></ion-icon>
                </button>
            {% endif %}

        <button id="delete_btn" onclick="if (confirm('Delete Post?')) location.href='delete'">Delete
            <ion-icon name="trash-outline"></ion-icon>
        </button>
    {% else %}
        <button id="report_btn" onclick="location.href='report'">Report
            <ion-icon name="flag-outline"></ion-icon>
        </button>
    {% endif %}
    </div>
    <hr>
    {% if post.status == 0 %}
        <div class="postcard-tag alert-error" title="Unpublished posts are not visible to the public and only you can access them"
        style="
            width: fit-content;
            padding: 3px 10px;
            font-family: 'Merriweather Sans';
            font-weight: 100;
            font-size: 0.7rem;
            display: flex;
            gap: 5px;
            align-items: center;
            flex-wrap: nowrap;
        ">
            <ion-icon name="cloud-offline-outline"></ion-icon>
            Unpublished
        </div>
    {% elif post.status == 2 %}
        <div class="postcard-tag alert-error" title="Unlisted posts are not visible to the public and only accessible via the URL"
        style="
            width: fit-content;
            padding: 3px 10px;
            font-family: 'Merriweather Sans';
            font-weight: 100;
            font-size: 0.7rem;
            display: flex;
            gap: 5px;
            align-items: center;
            flex-wrap: nowrap;
        ">
            <ion-icon name="link-outline"></ion-icon>
            Unlisted
        </div>
    {% endif %}
    <h1 id="postTitle">{% block title %} {{ post.title |capfirst }} {% endblock title %}</h1>
    <div id="postExcerpt">{% block excerpt %} {{ post.excerpt |capfirst }} {% endblock excerpt %}</div>
    <br>
    <div id="meta">
        <div id="author_block">
            <a href="/@{{ post.author.username }}">
                <img class="avatar_icon" src="{{ aws_media_url }}{{ post.author.profile.avatar }}"
                     alt="Avatar of {{ post.author }}">
            </a>
            <div>
                    <span id="postAuthor">
                        <a href="/@{{ post.author.username }}"> <span
                                id="author-username">@{{ post.author }} </span> </a>
                        <br>
                        <span id="reading-time">{{ post.reading_time }} min read</span> <span> Â· {{ post.views }} views</span>
                    </span>
            </div>
        </div>
        <div>
            <span>{% if post.created_on != post.updated_on %}
                Created{% endif %} {{ post.created_on  | date:"M d Y" }}</span>
            {% if post.created_on != post.updated_on %}
                <br><span>Updated {{ post.updated_on | date:"M d Y" }}</span>
            {% endif %}
        </div>
    </div>
    <hr>
    <div id="postContent">
        {{ post.content | safe }}
    </div>
    <hr>
    {% if post.tags %}
        <span class="tags">
            <span>Tags:</span>
            {% for tag in post.tags %}
                {% if tag %}
                    <a href="/search/posts/?search=tags:{{ tag }}"><span class="tag">{{ tag }}</span></a>
                {% endif %}
            {% endfor %}
            </span>
    {% endif %}
    <div id="more">
        <h4>More About The Author</h4>
        {% profile_card request post.author %}
        <br>
    </div>
    </div>
    {% endif %}

</div>

{% endblock content %}

{% load static %}
{% block styles %}
    <link rel="stylesheet" href="{% static 'css/post_detail.css' %}">
{% endblock %}

{% if post %}
    {% block meta %}
        {% meta_tags title=post.title description=post.excerpt keywords=post.tags %}
    {% endblock meta %}
{% endif %}
